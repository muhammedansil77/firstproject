<!-- views/user/pages/referrals.ejs -->
<main class="min-h-screen bg-gradient-to-br from-[#0a0a0a] via-[#0f0f0f] to-[#1a1a1a] text-white antialiased">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-white">Referral Program</h1>
      <p class="text-gray-400 mt-2">Invite friends & earn ₹100 for each successful referral</p>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <!-- Total Earnings -->
      <div class="bg-gradient-to-br from-[#0b0b0b] to-[#151515] border border-[#2a2a2a] rounded-2xl p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-400 text-sm">Total Earnings</p>
            <p class="text-[#d4af37] text-2xl font-bold mt-2">₹<%= totalEarned.toLocaleString('en-IN') %></p>
          </div>
          <div class="w-12 h-12 rounded-lg bg-[#d4af37]/10 flex items-center justify-center">
            <svg class="w-6 h-6 text-[#d4af37]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
        </div>
        <!-- In the stats cards section, add a withdrawal button -->
<div class="mt-8 flex justify-center">
    <a href="/user/withdraw" 
       class="px-8 py-3 bg-gradient-to-r from-[#d4af37] to-[#b8941f] text-black font-bold rounded-lg hover:shadow-lg hover:shadow-[#d4af37]/30 transition-all flex items-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        Withdraw Money
    </a>
</div>
      </div>

      <!-- Total Referrals -->
      <div class="bg-gradient-to-br from-[#0b0b0b] to-[#151515] border border-[#2a2a2a] rounded-2xl p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-400 text-sm">Total Referrals</p>
            <p class="text-white text-2xl font-bold mt-2"><%= user.totalReferrals || 0 %></p>
          </div>
          <div class="w-12 h-12 rounded-lg bg-blue-500/10 flex items-center justify-center">
            <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5 4.488V15h3m-3 4.488l-3-1.5-3 1.5"/>
            </svg>
          </div>
        </div>
      </div>

      <!-- Pending Earnings -->
      <div class="bg-gradient-to-br from-[#0b0b0b] to-[#151515] border border-[#2a2a2a] rounded-2xl p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-400 text-sm">Pending Earnings</p>
            <p class="text-yellow-400 text-2xl font-bold mt-2">₹<%= pendingEarnings.toLocaleString('en-IN') %></p>
          </div>
          <div class="w-12 h-12 rounded-lg bg-yellow-500/10 flex items-center justify-center">
            <svg class="w-6 h-6 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
        </div>
      </div>

      <!-- Wallet Balance -->
      <div class="bg-gradient-to-br from-[#0b0b0b] to-[#151515] border border-[#2a2a2a] rounded-2xl p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-400 text-sm">Wallet Balance</p>
            <p class="text-green-400 text-2xl font-bold mt-2">₹<%= user.walletBalance.toLocaleString('en-IN') %></p>
          </div>
          <div class="w-12 h-12 rounded-lg bg-green-500/10 flex items-center justify-center">
            <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- Referral Code Section -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
      <!-- Your Referral Code -->
      <div class="bg-gradient-to-br from-[#0b0b0b] to-[#151515] border border-[#2a2a2a] rounded-2xl p-6">
        <h2 class="text-xl font-bold text-white mb-4">Your Referral Code</h2>
        
        <div class="mb-6">
          <p class="text-gray-400 text-sm mb-3">Share this code with friends during signup</p>
        <div class="flex items-center gap-3">
  <div class="flex-1 bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg p-4">
    <p class="text-2xl font-bold text-[#d4af37] tracking-wider text-center" id="referralCodeDisplay">
      <%= user.referralCode || 'GENERATING...' %>
    </p>
  </div>
  <button 
    onclick="copyReferralCode()"
    class="px-4 py-3 bg-gradient-to-r from-[#d4af37] to-[#b8941f] text-black font-semibold rounded-lg hover:shadow-lg hover:shadow-[#d4af37]/20 transition-all"
    id="copyCodeButton"
  >
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
    </svg>
  </button>
</div>
        </div>

        <!-- Referral Link -->
        <div>
          <p class="text-gray-400 text-sm mb-3">Or share this link</p>
          <div class="flex items-center gap-3">
            <div class="flex-1 bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg p-3 overflow-hidden">
              <p class="text-gray-300 text-sm truncate" id="referralLink">
                <%= user.referralLink || '#' %>
              </p>
            </div>
            <button 
              onclick="copyReferralLink()"
              class="px-4 py-3 border border-[#2a2a2a] text-gray-300 hover:border-[#d4af37]/30 hover:text-[#d4af37] rounded-lg transition-all"
            >
              Copy Link
            </button>
          </div>
        </div>
      </div>

      <!-- How It Works -->
      <div class="bg-gradient-to-br from-[#0b0b0b] to-[#151515] border border-[#2a2a2a] rounded-2xl p-6">
        <h2 class="text-xl font-bold text-white mb-6">How It Works</h2>
        
        <div class="space-y-6">
          <div class="flex items-start gap-4">
            <div class="w-10 h-10 rounded-full bg-[#d4af37]/10 flex items-center justify-center flex-shrink-0">
              <span class="text-[#d4af37] font-bold">1</span>
            </div>
            <div>
              <h3 class="font-bold text-white mb-1">Share Your Code</h3>
              <p class="text-gray-400 text-sm">Share your unique referral code or link with friends</p>
            </div>
          </div>

          <div class="flex items-start gap-4">
            <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center flex-shrink-0">
              <span class="text-blue-400 font-bold">2</span>
            </div>
            <div>
              <h3 class="font-bold text-white mb-1">Friend Signs Up</h3>
              <p class="text-gray-400 text-sm">Your friend signs up using your referral code</p>
            </div>
          </div>

          <div class="flex items-start gap-4">
            <div class="w-10 h-10 rounded-full bg-green-500/10 flex items-center justify-center flex-shrink-0">
              <span class="text-green-400 font-bold">3</span>
            </div>
            <div>
              <h3 class="font-bold text-white mb-1">Friend Verifies Email</h3>
              <p class="text-gray-400 text-sm">Your friend verifies their email address</p>
            </div>
          </div>

          <div class="flex items-start gap-4">
            <div class="w-10 h-10 rounded-full bg-purple-500/10 flex items-center justify-center flex-shrink-0">
              <span class="text-purple-400 font-bold">4</span>
            </div>
            <div>
              <h3 class="font-bold text-white mb-1">You Earn ₹100</h3>
              <p class="text-gray-400 text-sm">₹100 is instantly credited to your wallet</p>
            </div>
          </div>
        </div>

        <!-- Bonus Info -->
        <div class="mt-8 p-4 bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg">
          <div class="flex items-center gap-3">
            <svg class="w-5 h-5 text-[#d4af37]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <p class="text-sm text-gray-300">
              <span class="text-[#d4af37] font-bold">Note:</span> Reward is credited after your friend verifies their email
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Referral History -->
    <div class="bg-gradient-to-br from-[#0b0b0b] to-[#151515] border border-[#2a2a2a] rounded-2xl p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold text-white">Referral History</h2>
        <span class="px-3 py-1 bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg text-gray-400 text-sm">
          Total: <%= referrals.length %>
        </span>
      </div>

      <% if (referrals && referrals.length > 0) { %>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr class="border-b border-[#2a2a2a]">
                <th class="text-left py-3 px-4 text-gray-400 font-medium">Friend</th>
                <th class="text-left py-3 px-4 text-gray-400 font-medium">Signup Date</th>
                <th class="text-left py-3 px-4 text-gray-400 font-medium">Status</th>
                <th class="text-left py-3 px-4 text-gray-400 font-medium">Reward</th>
                <th class="text-left py-3 px-4 text-gray-400 font-medium">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% referrals.forEach(referral => { 
                const friend = referral.referredUser;
                const statusColor = referral.status === 'completed' ? 'green' : 
                                  referral.status === 'pending' ? 'yellow' : 'red';
                const statusText = referral.status === 'completed' ? 'Completed' : 
                                 referral.status === 'pending' ? 'Pending' : 'Failed';
              %>
                <tr class="border-b border-[#2a2a2a]/50 hover:bg-[#1a1a1a]/50">
                  <td class="py-4 px-4">
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 rounded-full bg-[#2a2a2a] flex items-center justify-center">
                        <% if (friend.profilePicture) { %>
                          <img src="<%= friend.profilePicture %>" alt="<%= friend.fullName %>" class="w-full h-full rounded-full object-cover">
                        <% } else { %>
                          <span class="text-gray-400 font-bold">
                            <%= friend.fullName ? friend.fullName.charAt(0).toUpperCase() : 'U' %>
                          </span>
                        <% } %>
                      </div>
                      <div>
                        <p class="font-medium text-white"><%= friend.fullName || 'User' %></p>
                        <p class="text-gray-400 text-sm"><%= friend.email %></p>
                      </div>
                    </div>
                  </td>
                  <td class="py-4 px-4 text-gray-300">
                    <%= new Date(friend.createdAt).toLocaleDateString('en-IN', {
                      day: 'numeric',
                      month: 'short',
                      year: 'numeric'
                    }) %>
                  </td>
                  <td class="py-4 px-4">
                    <span class="px-3 py-1 rounded-full text-sm font-medium bg-<%= statusColor %>-500/10 text-<%= statusColor %>-400 border border-<%= statusColor %>-500/30">
                      <%= statusText %>
                    </span>
                  </td>
                  <td class="py-4 px-4">
                    <span class="text-[#d4af37] font-bold">
                      <% if (referral.status === 'completed') { %>
                        ₹100
                      <% } else if (referral.status === 'pending') { %>
                        Pending
                      <% } else { %>
                        ₹0
                      <% } %>
                    </span>
                  </td>
                  <td class="py-4 px-4">
                    <% if (referral.status === 'pending') { %>
                      <button 
                        onclick="remindFriend('<%= friend.email %>')"
                        class="px-3 py-1 border border-[#2a2a2a] text-gray-300 hover:border-[#d4af37]/30 hover:text-[#d4af37] rounded text-sm transition-all"
                      >
                        Remind
                      </button>
                    <% } else if (referral.status === 'completed') { %>
                      <span class="text-green-400 text-sm">✓ Credited</span>
                    <% } %>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <div class="text-center py-12">
          <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-[#d4af37]/10 flex items-center justify-center">
            <svg class="w-8 h-8 text-[#d4af37]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5 4.488V15h3m-3 4.488l-3-1.5-3 1.5"/>
            </svg>
          </div>
          <h3 class="text-lg font-bold text-white mb-2">No Referrals Yet</h3>
          <p class="text-gray-400 mb-6">Start inviting friends to earn rewards!</p>
        </div>
      <% } %>
    </div>

    <!-- Share Buttons -->
    <div class="mt-8 flex flex-wrap gap-4 justify-center">
      <button 
        onclick="shareViaWhatsApp()"
        class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg flex items-center gap-2 transition-all"
      >
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
          <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.76.982.998-3.675-.236-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.9 6.994c-.004 5.45-4.438 9.88-9.888 9.88m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.333.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.333 11.893-11.893 0-3.18-1.24-6.162-3.495-8.411"/>
        </svg>
        Share on WhatsApp
      </button>

      <button 
        onclick="shareViaEmail()"
        class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg flex items-center gap-2 transition-all"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
        </svg>
        Share via Email
      </button>

      <button 
        onclick="shareViaSMS()"
        class="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg flex items-center gap-2 transition-all"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
        </svg>
        Share via SMS
      </button>
    </div>
  </div>
</main>

<script>
// Copy referral code

</script>