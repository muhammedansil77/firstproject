<div class="admin-content-page px-4 py-4" style="background:#f8f9fa; min-height:100vh;">

  <div class="container" style="max-width:1200px;">

    <!-- Header -->
    <div class="bg-white rounded-3 shadow-sm p-4 mb-4 d-flex justify-content-between align-items-center">
      <div>
        <h2 class="fw-bold mb-1">Add New Product</h2>
        <p class="text-muted small mb-0">Create product and manage variants</p>
      </div>
      <a href="/admin/products" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i>Back
      </a>
    </div>
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index:1100">
  <div id="appToast" class="toast align-items-center text-bg-danger border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body" id="toastMessage">Error</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>

    <!-- Form -->
    <form id="createProductForm" enctype="multipart/form-data" novalidate>

      <!-- Basic Info -->
      <div class="bg-white rounded-3 shadow-sm p-4 mb-4">
        <h6 class="fw-bold mb-3">
          <i class="bi bi-info-circle me-2"></i>Basic Information
        </h6>

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label fw-semibold">Product Name *</label>
            <input name="name" class="form-control" required />
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Category</label>
            <select name="category" class="form-select">
              <option value="">-- Select Category --</option>
              <% categories.forEach(cat => { %>
                <option value="<%= cat._id %>"><%= cat.name %></option>
              <% }) %>
            </select>
          </div>

          <div class="col-12">
            <label class="form-label fw-semibold">Description</label>
            <textarea name="description" class="form-control" rows="4"></textarea>
          </div>
        </div>
      </div>

      <!-- Product Images -->
      <div class="bg-white rounded-3 shadow-sm p-4 mb-4">
        <h6 class="fw-bold mb-3">
          <i class="bi bi-images me-2"></i>Product Images (Optional)
        </h6>

        <input type="file" name="productImages[]" multiple accept="image/*" class="form-control" />
        <small class="text-muted">Variant images are mandatory (min 3 each)</small>
      </div>

      <!-- Variants -->
      <div class="bg-white rounded-3 shadow-sm p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h6 class="fw-bold mb-0">
            <i class="bi bi-box-seam me-2"></i>Variants
          </h6>
          <button type="button" id="addVariantBtn" class="btn btn-outline-primary btn-sm">
            <i class="bi bi-plus-circle me-1"></i>Add Variant
          </button>
        </div>

        <div id="variantsContainer"></div>

        <div class="alert alert-warning small mt-3">
          <i class="bi bi-exclamation-triangle me-1"></i>
          Each variant must have <strong>at least 3 images</strong>, color, stock & price.
        </div>
      </div>

      <!-- Submit -->
      <div class="text-end mt-4">
       <button type="submit" class="btn btn-success px-5" id="submitBtn">
  <span class="btn-text">Create Product</span>
  <span class="spinner-border spinner-border-sm d-none" role="status"></span>
</button>

      </div>

    </form>
  </div>
</div>

<!-- Variant Template -->
<template id="variantTpl">
  <div class="card mb-3 variant-row" data-idx="">
    <div class="card-header d-flex justify-content-between align-items-center">
      <strong>Variant</strong>
      <button type="button" class="btn btn-sm btn-outline-danger removeVariantBtn">
        Remove
      </button>
    </div>

    <div class="card-body">
      <div class="row g-3">

        <div class="col-md-6">
          <label class="form-label fw-semibold">Images (3+)*</label>
          <input type="file" class="form-control variant-image" multiple accept="image/*" required />
          <div class="variant-image-preview mt-2 d-flex gap-2 flex-wrap"></div>
        </div>

        <div class="col-md-6">
          <label class="form-label fw-semibold">Color *</label>
          <input class="form-control variant-color" required />

          <label class="form-label fw-semibold mt-3">Stock *</label>
          <input type="number" min="0" class="form-control variant-stock" required />

          <label class="form-label fw-semibold mt-3">Price *</label>
          <input type="number" min="0" class="form-control variant-price" required />
        </div>

      </div>
    </div>
  </div>
  <!-- Cropper Modal -->


</template>
<div class="modal fade" id="cropperModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Crop Image</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body text-center">
        <img id="cropperImage" style="max-width:100%;">
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button type="button" id="applyCropBtn" class="btn btn-primary">
          Apply Crop
        </button>
      </div>
    </div>
  </div>
</div>
